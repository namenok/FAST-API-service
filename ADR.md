
# Рішення: Архітектура бекенд-сервісу для інгесту та аналітики подій

## Контекст

Потрібно побудувати бекенд-сервіс, який:

* Приймає масив JSON-подій через `POST /events`
* Забезпечує ідемпотентність (`event_id`)
* Зберігає події у базі
* Підтримує аналітичні запити (`DAU`, `top-events`, `retention`)
* Має CLI для імпорту історичних даних
* Забезпечує спостережуваність, прості метрики, rate limiting та асинхронну обробку
* Для оцінки продуктивності реалізовано скрипт `benchmark.py` для тестування `POST` та `GET` endpoint’ів
* Використовуються агрегаційні функції PostgreSQL для підрахунку DAU, топів та ретеншну

---

## Варіанти

### Веб-фреймворк

* **Django REST Framework**

  * Мінуси: синхронний, складніше під асинхронний Celery

* **Flask**

  * Мінуси: відсутня асинхронність «з коробки»

* **FastAPI**

  * Плюси: асинхронний, висока продуктивність, автоматичний OpenAPI/Swagger, легко інтегрується з Celery
  * Новий для мене стек: FastAPI та автоматична генерація документації через Swagger/OpenAPI — новий досвід

---

### База даних

* **PostgreSQL**

  * Плюси: підтримка індексів і агрегацій, ACID, знайома технологія

* **MongoDB**

  * Мінуси: складніше забезпечити ідемпотентність, не оптимальна для SQL-агрегацій

---

### Черга для асинхронного інгесту

* **Redis + Celery**

  * Плюси: швидкий, простий локально, краще для першого досвіду

* **RabbitMQ**

  * Мінуси: складніше налаштувати для локальної розробки

---

### Тестування

* **pytest**

  * Плюси: простий синтаксис, легкий інтеграційний та unit тест

---

### Докер

* **Docker + docker-compose**

  * Плюси: легко підняти базу, Celery, Redis

---

## Рішення

* **Веб-фреймворк:** FastAPI — асинхронність, висока продуктивність, автоматична документація через Swagger/OpenAPI
* **База даних:** PostgreSQL — ідемпотентність, підтримка агрегаційних функцій, `jsonb` для властивостей подій
* **Черга:** Redis + Celery — асинхронний інгест
* **Тестування:** pytest — unit та інтеграційні тести
* **Спостережуваність:** структуровані логи (файл + консоль), метрики швидкості обробки
* **Rate limiting:** middleware з обмеженням на унікальних клієнтів
* **Бенчмарк:** `benchmark.py` — скрипт для вимірювання швидкості обробки подій і метрик
* **Аналітика:** використання агрегаційних функцій PostgreSQL для підрахунку DAU, топів і ретеншну


